# ResNet18 ImageNet â€” Snellius (A100), DALI Backend
#
# DALI moves JPEG decoding + augmentation to GPU, bypassing CPU bottleneck.
# Tuned for Snellius: lower num_threads to avoid contention with OMP_NUM_THREADS
# (launch_snellius.sh sets OMP_NUM_THREADS=16).
#
# Requirements: nvidia-dali-cuda120
#
# Usage:
#   sbatch --gpus-per-node=3 --cpus-per-task=54 scripts/launch_snellius.sh configs/resnet18_imagenet_snellius_dali.yaml
#   sbatch --gpus-per-node=1 --cpus-per-task=18 scripts/launch_snellius.sh configs/resnet18_imagenet_snellius_dali.yaml

experiment_name: resnet18_imagenet_snellius_dali

model:
  name: resnet18
  num_classes: 1000

data:
  dataset: imagenet
  root: "<IMAGENET_ROOT>"
  img_size: 224
  backend: dali

  dali:
    num_threads: 8              # Lower than 16 to avoid contention with OMP threads
    prefetch_queue_depth: 4
    decoder_device: gpu         # nvJPEG + HW decoder on A100

training:
  epochs: 40
  batch_size: 640
  lr: 0.16
  min_lr: 0.0
  weight_decay: 1e-4
  optimizer: sgd
  momentum: 0.9
  scheduler: cosine
  label_smoothing: 0.1
  use_amp: true
  compile: false
  sync_bn: false
  channels_last: true
  val_frequency: 5
  save_frequency: 5
  disable_progress_bar: false

logging:
  log_dir: logs
